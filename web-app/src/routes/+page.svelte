<script lang="ts">
    import "../app.css";

    import SignedIn from "clerk-sveltekit/client/SignedIn.svelte";
    import SignedOut from "clerk-sveltekit/client/SignedOut.svelte";
    import UserButton from "clerk-sveltekit/client/UserButton.svelte";
    import SignInButton from "clerk-sveltekit/client/SignInButton.svelte";

    import { onMount, onDestroy } from "svelte";
    import { AppGlobals } from "$lib/globals";
    import { start } from "$lib/index";

    let canvas: HTMLCanvasElement;
    let globals: AppGlobals;

    onMount(() => {
        if (!canvas) throw new Error("Canvas not found");
        globals = new AppGlobals(canvas);
        start(globals);
    });

    onDestroy(() => {
        if (globals) {
            globals.stopClock();
            globals.disconnect();
        }

        if (canvas) {
            canvas.remove();
        }
    });
</script>

<div class="w-screen h-screen flex place-items-center flex-col">
    <div
        class="text-white mt-2 text-xs px-3 flex justify-between w-full place-items-center"
    >
        <h1 class="text-lg">ASCII Depths</h1>
        <div class="flex gap-4 place-items-center">
            <a
                href="https://github.com/NotReeceHarris/asciidepths.com"
                target="_blank"
            >
                <svg
                    class="size-5"
                    viewBox="0 0 160 160"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    height="160"
                    width="160"
                    ><path
                        d="M79.99933333333334 3.534666666666667c-18.616000000000003 0.0006666666666666668 -36.62466666666666 6.626 -50.80266666666667 18.689333333333334C15.018 34.28733333333333 5.594666666666667 51.00266666666667 2.612666666666667 69.37866666666667c-2.9819999999999998 18.375333333333334 0.672 37.21266666666667 10.308 53.141333333333336 9.635333333333334 15.927333333333333 24.62466666666667 27.907333333333334 42.28533333333334 33.79533333333334 3.92 0.686 5.390000000000001 -1.6660000000000001 5.390000000000001 -3.724 0 -1.862 -0.098 -8.036000000000001 -0.098 -14.602000000000002 -19.698 3.6260000000000003 -24.794 -4.801333333333333 -26.362000000000002 -9.211333333333334 -1.7400000000000002 -4.288666666666667 -4.498 -8.089333333333334 -8.036000000000001 -11.074 -2.744 -1.47 -6.664000000000001 -5.096 -0.098 -5.194 2.5073333333333334 0.272 4.911333333333333 1.1446666666666667 7.010000000000001 2.5433333333333334 2.098 1.3986666666666667 3.828666666666667 3.283333333333333 5.0440000000000005 5.492666666666667 1.072 1.926 2.5140000000000002 3.6220000000000003 4.242666666666667 4.99 1.7286666666666666 1.368 3.7106666666666666 2.382 5.832000000000001 2.9819999999999998 2.1213333333333333 0.6006666666666667 4.340000000000001 0.7773333333333333 6.529333333333334 0.5193333333333333s4.306666666666667 -0.9453333333333335 6.229333333333334 -2.0233333333333334c0.3393333333333334 -3.986 2.116 -7.712666666666667 4.998666666666667 -10.486 -17.444000000000003 -1.96 -35.672 -8.722000000000001 -35.672 -38.71 -0.11000000000000001 -7.791333333333334 2.764666666666667 -15.330000000000002 8.036000000000001 -21.069333333333336 -2.3966666666666665 -6.772 -2.1166666666666667 -14.203999999999999 0.784 -20.776 0 0 6.565333333333333 -2.058 21.560000000000002 8.036000000000001 12.828 -3.528 26.37066666666667 -3.528 39.199333333333335 0 14.994 -10.192 21.560000000000002 -8.036000000000001 21.560000000000002 -8.036000000000001 2.9006666666666665 6.572 3.1813333333333333 14.004000000000001 0.784 20.776 5.2860000000000005 5.729333333333334 8.164666666666667 13.275333333333334 8.036000000000001 21.069333333333336 0 30.086000000000002 -18.326 36.75 -35.77 38.71 1.870666666666667 1.896 3.3113333333333332 4.173333333333334 4.224666666666667 6.6753333333333345 0.9133333333333334 2.5033333333333334 1.2773333333333334 5.173333333333334 1.0673333333333332 7.828666666666666 0 10.486666666666666 -0.098 18.913333333333334 -0.098 21.559333333333335 0 2.058 1.47 4.508 5.390000000000001 3.724 17.629333333333335 -5.935333333333333 32.57533333333334 -17.943333333333335 42.17 -33.879333333333335 9.595333333333334 -15.936666666666666 13.214 -34.76466666666666 10.211333333333334 -53.12266666666667 -3.002666666666667 -18.357333333333333 -12.431333333333335 -35.05066666666667 -26.604000000000003 -47.099333333333334C116.59466666666667 10.164666666666667 98.60133333333334 3.5446666666666666 79.99933333333334 3.534666666666667Z"
                        fill="currentColor"
                        stroke-width="1"
                    ></path></svg
                >
            </a>
            <SignedIn>
                <UserButton />
            </SignedIn>
            <SignedOut>
                <SignInButton>
                    <svg
                        class="size-5 p-[1px]"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"
                        ></path><polyline points="10 17 15 12 10 7"
                        ></polyline><line x1="15" y1="12" x2="3" y2="12"
                        ></line></svg
                    >
                </SignInButton>
            </SignedOut>
        </div>
    </div>
    <canvas
        bind:this={canvas}
        class="z-20 w-screen max-h-[calc(100vh-28px-8px)] p-2 pt-4 mx-auto aspect-[2/1]"
    />
    <div class="absolute text-white top-[calc(50vh-12px)]">Loading...</div>
</div>
